package br.com.deschateie.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import br.com.deschateie.beans.Conversa;
import br.com.deschateie.beans.Voluntario;
import br.com.deschateie.conexao.Conexao;

public class ConversaDAO {
	private Connection con;
	private PreparedStatement stmt;
	private ResultSet rs;
	
	public ConversaDAO()throws Exception{
		con = new Conexao().conectar();
	}
	
	public Conversa consultarConversa(int codConversa)throws Exception{
		stmt = con.prepareStatement("SELECT * FROM T_SCP_CONVERSA INNER JOIN T_SCP_VOLUNTARIO ON "
									+ "(T_SCP_CONVERSA.CD_VOLUNTARIO = T_SCP_VOLUNTARIO.CD_VOLUNTARIO)"
									+ " INNER JOINT T_SCP_USUARIO ON () WHERE T_SCP_CONVERSA.CD_CONVERSA = ?");
		stmt.setInt(1, codConversa);
		rs = stmt.executeQuery();
		if (rs.next()) {
			return new Conversa(
					rs.getInt("CD_CONVERSA"),
					rs.getString("HR_INICIO"),
					rs.getInt("QT_RESPOSTAS"),
					rs.getString("DS_HISTORICO"),
					rs.getString("HR_TERMINO"),
					new  Voluntario(
							rs.getInt("CD_VOLUNTARIO"),
							rs.getString("NR_RG"),
							rs.getLong("NR_CPF"),
							rs.getString("DS_FORMACAO"), 
							rs.getString("DS_PERIODO"), 
							rs.getString("DS_COMENTARIO"), 
							rs.getLong("DS_TELEFONE")));
		}
		
		return new Conversa();
	}

	public void fechar()throws Exception{
		con.close();
	}
	
}
